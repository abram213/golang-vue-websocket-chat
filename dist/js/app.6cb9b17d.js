(function(e){function t(t){for(var a,s,i=t[0],c=t[1],l=t[2],u=0,d=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);h&&h(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var i=n[s];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var a={},s={app:0},r={app:0},o=[];function i(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-08db41af":"21388333","chunk-0dd909ea":"e5af0c3c","chunk-1276eb30":"e2c36de0","chunk-2368e12a":"e7708731","chunk-2d21dbac":"131a454d","chunk-2d229295":"092d3e58","chunk-e5e811c8":"7951f21c"}[e]+".js"}function c(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-08db41af":1,"chunk-0dd909ea":1,"chunk-1276eb30":1,"chunk-2368e12a":1,"chunk-e5e811c8":1};s[e]?t.push(s[e]):0!==s[e]&&n[e]&&t.push(s[e]=new Promise((function(t,n){for(var a="css/"+({}[e]||e)+"."+{"chunk-08db41af":"8b8f4869","chunk-0dd909ea":"21fe44c6","chunk-1276eb30":"4c2b7a3a","chunk-2368e12a":"5fb07a11","chunk-2d21dbac":"31d6cfe0","chunk-2d229295":"31d6cfe0","chunk-e5e811c8":"4c2b7a3a"}[e]+".css",r=c.p+a,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var l=o[i],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===r))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){l=d[i],u=l.getAttribute("data-href");if(u===a||u===r)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var a=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=a,delete s[e],h.parentNode.removeChild(h),n(o)},h.href=r;var f=document.getElementsByTagName("head")[0];f.appendChild(h)})).then((function(){s[e]=0})));var a=r[e];if(0!==a)if(a)t.push(a[2]);else{var o=new Promise((function(t,n){a=r[e]=[t,n]}));t.push(a[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=i(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(h);var n=r[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+a+": "+s+")",d.name="ChunkLoadError",d.type=a,d.request=s,n[1](d)}r[e]=void 0}};var h=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=a,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)c.d(n,a,function(t){return e[t]}.bind(null,a));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=u;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var a=n("71ec"),s=n.n(a);s.a},"56d7":function(e,t,n){"use strict";n.r(t);var a=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-content",[n("router-view")],1)],1)},r=[],o={name:"App"},i=o,c=(n("034f"),n("2877")),l=n("6544"),u=n.n(l),d=n("7496"),h=n("a75b"),f=Object(c["a"])(i,s,r,!1,null,null,null),p=f.exports;u()(f,{VApp:d["a"],VContent:h["a"]});var m=n("8c4f"),v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticClass:"pa-0",attrs:{fluid:"","fill-height":"","align-start":""}},[n("v-row",{staticClass:"fill-height",attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"12",xl:"3",lg:"3",md:"4",sm:"4"}},[n("v-card",{attrs:{height:"100%",flat:"",tile:""}},[n("router-view")],1)],1),n("v-col",{staticClass:"grey lighten-3"},[e.credentials?[n("Chat")]:n("Loader")],2)],1)],1)},g=[],_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%"}},[n("Toolbar",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("\n      "+e._s(e.chat?e.chat.title:"Chat name")+"\n    ")]},proxy:!0},e.chat?{key:"append",fn:function(){return[n("Settings")]},proxy:!0}:null],null,!0)}),e.chat&&"success"===e.wsStatus?n("v-flex",{staticStyle:{position:"relative"},attrs:{xs12:""}},[n("div",{ref:"scrollableDiv",staticClass:"chat-container"},e._l(e.chat.messages,(function(t,a){return n("div",{key:t.id,staticClass:"message",class:{own:t.user_id==e.credentials.id}},[n("div",{staticStyle:{"margin-top":"5px"}}),n("div",{staticClass:"content"},[n("div",{domProps:{innerHTML:e._s(t.body)}})])])})),0),n("v-text-field",{staticClass:"px-4 pt-2",attrs:{solo:"",counter:255,placeholder:"Your message","append-outer-icon":"mdi-send"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)},"click:append-outer":e.sendMessage},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1):"loading"===e.wsStatus?n("Loader"):n("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[n("div",{staticClass:"text-xs-center"},[n("v-chip",{staticStyle:{opacity:"0.6"},attrs:{small:"",dark:""}},[e._v("Please select a chat to start a conversation")])],1)])],1)},k=[],b=n("6908"),E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-center"},[n("v-menu",{attrs:{"close-on-content-click":!1,"offset-y":"",left:"","nudge-right":"20","min-width":"400"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on;return[n("v-btn",e._g({attrs:{icon:""}},a),[n("v-icon",[e._v("mdi-dots-vertical")])],1)]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[n("v-card",[n("v-card-title",{staticClass:"subtitle-1"},[e._v("\n          Chat settings\n        ")]),n("v-card-text",{staticClass:"pb-0"},[n("v-text-field",{attrs:{outlined:"",dense:"",label:"Chat title",readonly:!e.editTitle,"append-outer-icon":e.editTitle?"mdi-check":"mdi-pencil"},on:{"click:append-outer":function(t){e.editTitle=!e.editTitle}},model:{value:e.chat.title,callback:function(t){e.$set(e.chat,"title",t)},expression:"chat.title"}})],1),n("v-subheader",{staticClass:"pl-5"},[e._v("Chat users")]),e.chat.users&&e.chat.users.length?n("v-list",{staticClass:"pt-0 overflow-y-auto",staticStyle:{"max-height":"200px"},attrs:{dense:""}},[e._l(e.chat.users,(function(t,a){return[0!=a?n("v-divider",{key:a,attrs:{inset:""}}):e._e(),n("v-list-item",{key:t.id,staticClass:"pr-1"},[n("v-list-item-avatar",[n("v-icon",{attrs:{large:""}},[e._v("mdi-account-circle")])],1),n("v-list-item-content",[n("v-list-item-title",{domProps:{textContent:e._s(t.username)}})],1),t.id===e.chat.user_id?n("v-chip",{staticClass:"mx-1",attrs:{outlined:"",color:"primary"}},[e._v("Chat admin")]):e._e()],1)]})),n("v-divider",{attrs:{inset:""}})],2):e._e()],1)],1)],1)},S=[],C={data:()=>({menu:!1,editTitle:!1}),computed:{chat(){return this.$store.state.chat.chat}}},w=C,y=n("8336"),T=n("b0af"),x=n("99d9"),O=n("cc20"),A=n("ce7e"),R=n("132d"),V=n("8860"),U=n("da13"),L=n("8270"),B=n("5d23"),I=n("e449"),P=n("e0c7"),H=n("8654"),j=Object(c["a"])(w,E,S,!1,null,null,null),N=j.exports;u()(j,{VBtn:y["a"],VCard:T["a"],VCardText:x["b"],VCardTitle:x["c"],VChip:O["a"],VDivider:A["a"],VIcon:R["a"],VList:V["a"],VListItem:U["a"],VListItemAvatar:L["a"],VListItemContent:B["a"],VListItemTitle:B["c"],VMenu:I["a"],VSubheader:P["a"],VTextField:H["a"]});var $={name:"Chat",data:()=>({message:""}),components:{Toolbar:b["a"],Settings:N},methods:{sendMessage(){if(""!==this.message){const e={body:this.message,chat_identifier:this.chat.identifier,user_id:this.senderId};this.$store.dispatch("wsSendMessage",e).then(()=>{this.message=""}).catch(e=>{console.log("web socket error")})}},scroll(){this.$refs.scrollableDiv.scrollTop=this.$refs.scrollableDiv.scrollHeight}},computed:{chat(){return this.$store.state.chat.chat},credentials(){return this.$store.state.user.userCredentials},wsStatus(){return this.$store.state.chat.wsStatus}}},G=$,M=(n("f196"),n("0e8f")),D=n("a722"),W=Object(c["a"])(G,_,k,!1,null,null,null),F=W.exports;u()(W,{VChip:O["a"],VFlex:M["a"],VLayout:D["a"],VTextField:H["a"]});var K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[n("div",{staticClass:"text-xs-center"},[n("v-progress-circular",{attrs:{size:50,color:"grey darken-4",indeterminate:""}})],1)])},z=[],J=n("490a"),Q={},q=Object(c["a"])(Q,K,z,!1,null,null,null),Y=q.exports;u()(q,{VLayout:D["a"],VProgressCircular:J["a"]});var X={name:"Home",components:{Chat:F,Loader:Y},computed:{credentials(){return this.$store.state.user.userCredentials}}},Z=X,ee=n("62ad"),te=n("a523"),ne=n("0fd9"),ae=Object(c["a"])(Z,v,g,!1,null,null,null),se=ae.exports;u()(ae,{VCard:T["a"],VCol:ee["a"],VContainer:te["a"],VRow:ne["a"]});var re=n("2f62"),oe=n("bc3a"),ie=n.n(oe);let ce={version:"0.2",host:"http://127.0.0.1:"+document.location.port};var le=ce,ue={state:{authStatus:"none",token:"",expiresIn:"",authError:""},getters:{isAuth:e=>!!e.token,authStatus:e=>e.authStatus,authError:e=>e.authError},mutations:{AUTH_REQUEST:e=>{e.authStatus="loading"},AUTH_SUCCESS:(e,t,n)=>{e.authStatus="success",e.token=t,e.expiresIn=n},AUTH_ERROR:(e,t)=>{e.authStatus="error",e.authError=t,e.token="",e.expiresIn=""},AUTH_LOGOUT:e=>{e.expiresIn="",e.token="",e.authStatus="none"}},actions:{signIn({commit:e},t){return new Promise((n,s)=>{e("AUTH_REQUEST"),ie.a.post("/auth/sign_in",JSON.stringify(t)).then((function(t){const s=t.data.access_token,r=t.data.access_expires_in,o=t.data.refresh_token;a["a"].cookie.set("access_token",s),a["a"].cookie.set("expires_in",r),a["a"].cookie.set("refresh_token",o),ie.a.defaults.headers.common["Authorization"]="Bearer "+s,e("AUTH_SUCCESS",s,r),n(t)})).catch(t=>{a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete ie.a.defaults.headers.common["Authorization"];let n="Internal server error";t.response&&401===t.response.status&&(n="Wrong username or password"),e("AUTH_ERROR",n),s(t)})})},signUp({commit:e},t){return new Promise((n,s)=>{e("AUTH_REQUEST"),ie.a.post("/auth/sign_up",JSON.stringify(t)).then((function(t){const s=t.data.access_token,r=t.data.access_expires_in,o=t.data.refresh_token;a["a"].cookie.set("access_token",s),a["a"].cookie.set("expires_in",r),a["a"].cookie.set("refresh_token",o),ie.a.defaults.headers.common["Authorization"]="Bearer "+s,e("AUTH_SUCCESS",s,r),n(t)})).catch(t=>{a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete ie.a.defaults.headers.common["Authorization"];let n="Internal server error";t.response&&t.response.data&&(n=t.response.data.message),e("AUTH_ERROR",n),s(t)})})},logout(){a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete ie.a.defaults.headers.common["Authorization"],window.location.reload()}}},de={state:{userCredentials:null,user:null,users:null,friends:null},getters:{usersWithFriendship:e=>{let t=[];return e.users&&e.friends&&e.users.forEach(n=>{n.friendship=!1,e.friends.forEach(e=>{e.id===n.id&&(n.friendship=!0)}),t.push(n)}),t}},mutations:{GET_USER_CREDENTIALS:(e,t)=>{e.userCredentials=t},GET_USER:(e,t)=>{e.user=t},GET_USERS:(e,t)=>{e.users=t},GET_FRIENDS:(e,t)=>{e.friends=t}},actions:{getUsers({commit:e,state:t}){ie.a.get("/users").then((function(t){e("GET_USERS",t.data)})).catch(e=>{console.log(e)})},getUser({commit:e,state:t},n){ie.a.get("/users/"+n).then((function(t){e("GET_USER",t.data)})).catch(e=>{console.log(e)})},getFriends({commit:e,state:t}){ie.a.get("/users/friends").then((function(t){e("GET_FRIENDS",t.data)})).catch(e=>{console.log(e)})},addFriend({commit:e,state:t},n){return new Promise((e,t)=>{ie.a.get("/users/friends/"+n+"/add").then((function(t){e(t.data)})).catch(e=>{t(e)})})},deleteFriend({commit:e,state:t},n){return new Promise((e,t)=>{ie.a.delete("/users/friends/"+n+"/delete").then((function(t){e(t.data)})).catch(e=>{t(e)})})},getUserCredentials({commit:e,state:t}){ie.a.get("/users/info").then((function(t){e("GET_USER_CREDENTIALS",t.data)})).catch(e=>{console.log(e)})}}},he={state:{chat:null,chats:null,ws:null,wsStatus:"none"},getters:{},mutations:{GET_CHAT:(e,t)=>{e.chat=t},GET_CHATS:(e,t)=>{e.chats=t},PUSH_MESSAGE:(e,t)=>{e.chat.messages.push(t)},CONN_WEBSOCKET:(e,t)=>{e.ws=t,e.wsStatus="success",console.log("Connected")},ERROR_WEBSOKET:e=>{e.wsStatus="error"},LOADING_WEBSOKET:e=>{e.wsStatus="loading"},CLOSE_WEBSOCKET:e=>{e.ws&&e.ws.close(),e.wsStatus="none"}},actions:{getChats({commit:e,state:t}){ie.a.get("/chats").then((function(t){e("GET_CHATS",t.data)})).catch(e=>{console.log(e)})},getChat({commit:e,dispatch:t},n){t("wsClose"),e("LOADING_WEBSOKET"),ie.a.get("/chats/"+n).then((function(n){e("GET_CHAT",n.data),t("wsConn",n.data.identifier)})).catch(t=>{e("ERROR_WEBSOCKET"),console.log(t)})},wsConn({commit:e,state:t},n){const a="https:"===window.location.protocol?"wss":"ws",s=window.location.port;let r=new WebSocket(a+"://localhost:"+s+"/ws/conn?id="+n);e("CONN_WEBSOCKET",r),t.ws.onclose=function(e){console.log("Connection closed")},t.ws.onmessage=function(t){var n=JSON.parse(t.data);e("PUSH_MESSAGE",n)}},wsClose({commit:e,state:t}){t.chat=null,e("CLOSE_WEBSOCKET")},wsSendMessage({commit:e,state:t},n){return new Promise((a,s)=>{t.ws?(t.ws.send(JSON.stringify(n)),a()):(e("ERROR_WEBSOKET"),s())})}}};a["a"].use(re["a"]),ie.a.defaults.baseURL=`${le.host}/api`;var fe=new re["a"].Store({state:{},mutations:{},actions:{},modules:{auth:ue,user:de,chat:he}});a["a"].use(m["a"]);const pe=(e,t,n)=>{fe.getters.isAuth?n():n("/sign_in")},me=(e,t,n)=>{fe.getters.isAuth?n("/"):n()};var ve=new m["a"]({mode:"history",base:"/",routes:[{path:"/",component:se,children:[{path:"",name:"menu",component:()=>n.e("chunk-08db41af").then(n.bind(null,"fb62"))},{path:"chats",name:"chats",component:()=>n.e("chunk-2368e12a").then(n.bind(null,"ac11"))},{path:"friends",name:"friends",component:()=>n.e("chunk-2d21dbac").then(n.bind(null,"d318"))},{path:"settings",name:"settings",component:()=>n.e("chunk-0dd909ea").then(n.bind(null,"f9ea"))},{path:"users",name:"users",component:()=>n.e("chunk-2d229295").then(n.bind(null,"dbef"))}],beforeEnter:pe},{path:"/sign_in",name:"sign_in",component:()=>n.e("chunk-e5e811c8").then(n.bind(null,"54e2")),beforeEnter:me},{path:"/sign_up",name:"sign_up",component:()=>n.e("chunk-1276eb30").then(n.bind(null,"5c9c")),beforeEnter:me}]}),ge=n("f309");a["a"].use(ge["a"]);var _e=new ge["a"]({}),ke=n("00e7"),be=n.n(ke);a["a"].use(be.a),a["a"].config.productionTip=!1;const Ee=a["a"].cookie.get("access_token"),Se=a["a"].cookie.get("refresh_token"),Ce=a["a"].cookie.get("expires_in");Ee&&Ce&&Se?(fe.state.auth.token=Ee,fe.state.auth.expiresIn=Ce,ie.a.defaults.headers.common["Authorization"]="Bearer "+Ee,fe.dispatch("getUserCredentials")):(a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token")),new a["a"]({router:ve,store:fe,vuetify:_e,render:e=>e(p)}).$mount("#app")},6908:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app-bar",{attrs:{dense:"",dark:"",flat:""}},[e.backBtn?n("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$router.go(-1)}}},[n("v-icon",[e._v("mdi-arrow-left")])],1):e._e(),e.search?n("v-text-field",{attrs:{dark:""}}):[e._t("prepend"),n("v-toolbar-title",[e._t("title",[e._v("\n                Label\n            ")])],2),n("v-spacer"),e._t("append")],e.searchBtn?n("v-btn",{attrs:{icon:""},on:{click:function(t){e.search=!e.search}}},[n("v-icon",[e._v("mdi-magnify")])],1):e._e()],2)},s=[],r={name:"Toolbar",data(){return{search:!1}},props:{searchBtn:{type:Boolean,default:!1},backBtn:{type:Boolean,default:!1}}},o=r,i=n("2877"),c=n("6544"),l=n.n(c),u=n("40dc"),d=n("8336"),h=n("132d"),f=n("2fa4"),p=n("8654"),m=n("2a7f"),v=Object(i["a"])(o,a,s,!1,null,null,null);t["a"]=v.exports;l()(v,{VAppBar:u["a"],VBtn:d["a"],VIcon:h["a"],VSpacer:f["a"],VTextField:p["a"],VToolbarTitle:m["a"]})},"71ec":function(e,t,n){},f196:function(e,t,n){"use strict";var a=n("f760"),s=n.n(a);s.a},f760:function(e,t,n){}});
//# sourceMappingURL=app.6cb9b17d.js.map