(function(e){function t(t){for(var a,s,i=t[0],c=t[1],l=t[2],u=0,d=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);h&&h(t);while(d.length)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,s=1;s<n.length;s++){var i=n[s];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var a={},s={app:0},r={app:0},o=[];function i(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-39ad721c":"d52b0583","chunk-3850b694":"b7026700","chunk-42370543":"53b55368","chunk-566a4814":"8732ed7f","chunk-608f7f58":"4cbffa9a","chunk-7eba8c30":"6d305628","chunk-7f6c7d8e":"98a4e239","chunk-ee490326":"f87fdc69"}[e]+".js"}function c(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-39ad721c":1,"chunk-3850b694":1,"chunk-42370543":1,"chunk-566a4814":1,"chunk-7f6c7d8e":1,"chunk-ee490326":1};s[e]?t.push(s[e]):0!==s[e]&&n[e]&&t.push(s[e]=new Promise((function(t,n){for(var a="css/"+({}[e]||e)+"."+{"chunk-39ad721c":"60414561","chunk-3850b694":"8b8f4869","chunk-42370543":"b9c7f741","chunk-566a4814":"5fb07a11","chunk-608f7f58":"31d6cfe0","chunk-7eba8c30":"31d6cfe0","chunk-7f6c7d8e":"73b2aa26","chunk-ee490326":"73b2aa26"}[e]+".css",r=c.p+a,o=document.getElementsByTagName("link"),i=0;i<o.length;i++){var l=o[i],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===a||u===r))return t()}var d=document.getElementsByTagName("style");for(i=0;i<d.length;i++){l=d[i],u=l.getAttribute("data-href");if(u===a||u===r)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var a=t&&t.target&&t.target.src||r,o=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");o.code="CSS_CHUNK_LOAD_FAILED",o.request=a,delete s[e],h.parentNode.removeChild(h),n(o)},h.href=r;var f=document.getElementsByTagName("head")[0];f.appendChild(h)})).then((function(){s[e]=0})));var a=r[e];if(0!==a)if(a)t.push(a[2]);else{var o=new Promise((function(t,n){a=r[e]=[t,n]}));t.push(a[2]=o);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=i(e);var d=new Error;l=function(t){u.onerror=u.onload=null,clearTimeout(h);var n=r[e];if(0!==n){if(n){var a=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+a+": "+s+")",d.name="ChunkLoadError",d.type=a,d.request=s,n[1](d)}r[e]=void 0}};var h=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=a,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)c.d(n,a,function(t){return e[t]}.bind(null,a));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var h=u;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);var a=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-content",[n("router-view")],1)],1)},r=[],o={name:"App"},i=o,c=n("2877"),l=n("6544"),u=n.n(l),d=n("7496"),h=n("a75b"),f=Object(c["a"])(i,s,r,!1,null,null,null),p=f.exports;u()(f,{VApp:d["a"],VContent:h["a"]});var m=n("8c4f"),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticClass:"pa-0",attrs:{fluid:"","fill-height":"","align-start":""}},[n("v-row",{staticClass:"fill-height",attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"12",xl:"3",lg:"3",md:"4",sm:"4"}},[n("v-card",{attrs:{height:"100%",flat:"",tile:""}},[n("router-view")],1)],1),n("v-col",{staticClass:"grey lighten-3"},[e.credentials?[n("Toolbar",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("\n                          "+e._s(e.chat?e.chat.title:"Chat name")+"\n                      ")]},proxy:!0}],null,!1,2394934178)}),e.chat&&"success"===e.wsStatus?n("Chat",{attrs:{initChat:e.chat,initSenderId:e.credentials.id}}):"loading"===e.wsStatus?n("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[n("div",{staticClass:"text-xs-center"},[n("v-progress-circular",{attrs:{size:50,color:"grey darken-4",indeterminate:""}})],1)]):n("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[n("div",{staticClass:"text-xs-center"},[n("v-chip",{staticStyle:{opacity:"0.6"},attrs:{small:"",dark:""}},[e._v("Please select a chat to start a conversation")])],1)])]:n("v-layout",{attrs:{"align-center":"","justify-center":"",row:"","fill-height":""}},[n("div",{staticClass:"text-xs-center"},[n("v-progress-circular",{attrs:{size:50,color:"grey darken-4",indeterminate:""}})],1)])],2)],1)],1)},k=[],_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-flex",{staticStyle:{position:"relative"},attrs:{xs12:""}},[n("div",{ref:"scrollableDiv",staticClass:"chat-container"},e._l(e.chat.messages,(function(t,a){return n("div",{key:t.id,staticClass:"message",class:{own:t.user_id==e.senderId}},[n("div",{staticStyle:{"margin-top":"5px"}}),n("div",{staticClass:"content"},[n("div",{domProps:{innerHTML:e._s(t.body)}})])])})),0),n("v-text-field",{staticClass:"px-4 pt-2",attrs:{solo:"",counter:255,placeholder:"Your message","append-outer-icon":"mdi-send"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage(t)},"click:append-outer":e.sendMessage},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)},v=[],E={name:"Chat",props:{initChat:{type:Object,required:!0},initSenderId:{type:Number,required:!0}},data:()=>({message:""}),methods:{sendMessage(){if(""!==this.message){const e={body:this.message,chat_identifier:this.chat.identifier,user_id:this.senderId};this.$store.dispatch("wsSendMessage",e).then(()=>{this.message=""}).catch(e=>{console.log("web socket error")})}},scroll(){this.$refs.scrollableDiv.scrollTop=this.$refs.scrollableDiv.scrollHeight}},computed:{chat(){return this.initChat},senderId(){return this.initSenderId}}},S=E,b=(n("f196"),n("0e8f")),w=n("8654"),C=Object(c["a"])(S,_,v,!1,null,null,null),y=C.exports;u()(C,{VFlex:b["a"],VTextField:w["a"]});var T=n("6908"),O={name:"Home",components:{Chat:y,Toolbar:T["a"]},computed:{chat(){return this.$store.state.chat.chat},credentials(){return this.$store.state.user.userCredentials},wsStatus(){return this.$store.state.chat.wsStatus}}},x=O,A=n("b0af"),R=n("cc20"),U=n("62ad"),P=n("a523"),I=n("a722"),H=n("490a"),N=n("0fd9"),j=Object(c["a"])(x,g,k,!1,null,null,null),G=j.exports;u()(j,{VCard:A["a"],VChip:R["a"],VCol:U["a"],VContainer:P["a"],VLayout:I["a"],VProgressCircular:H["a"],VRow:N["a"]});var B=n("2f62"),L=n("bc3a"),V=n.n(L);let M={version:"0.2",host:"http://localhost:4545"};var W=M,$={state:{authStatus:"none",token:"",expiresIn:"",authError:""},getters:{isAuth:e=>!!e.token,authStatus:e=>e.authStatus,authError:e=>e.authError},mutations:{AUTH_REQUEST:e=>{e.authStatus="loading"},AUTH_SUCCESS:(e,t,n)=>{e.authStatus="success",e.token=t,e.expiresIn=n},AUTH_ERROR:(e,t)=>{e.authStatus="error",e.authError=t,e.token="",e.expiresIn=""},AUTH_LOGOUT:e=>{e.expiresIn="",e.token="",e.authStatus="none"}},actions:{signIn({commit:e},t){return new Promise((n,s)=>{e("AUTH_REQUEST"),V.a.post("/auth/sign_in",JSON.stringify(t)).then((function(t){const s=t.data.access_token,r=t.data.access_expires_in,o=t.data.refresh_token;a["a"].cookie.set("access_token",s),a["a"].cookie.set("expires_in",r),a["a"].cookie.set("refresh_token",o),V.a.defaults.headers.common["Authorization"]="Bearer "+s,e("AUTH_SUCCESS",s,r),n(t)})).catch(t=>{a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete V.a.defaults.headers.common["Authorization"];let n="Internal server error";t.response&&401===t.response.status&&(n="Wrong username or password"),e("AUTH_ERROR",n),s(t)})})},signUp({commit:e},t){return new Promise((n,s)=>{e("AUTH_REQUEST"),V.a.post("/auth/sign_up",JSON.stringify(t)).then((function(t){const s=t.data.access_token,r=t.data.access_expires_in,o=t.data.refresh_token;a["a"].cookie.set("access_token",s),a["a"].cookie.set("expires_in",r),a["a"].cookie.set("refresh_token",o),V.a.defaults.headers.common["Authorization"]="Bearer "+s,e("AUTH_SUCCESS",s,r),n(t)})).catch(t=>{a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete V.a.defaults.headers.common["Authorization"];let n="Internal server error";t.response&&t.response.data&&(n=t.response.data.message),e("AUTH_ERROR",n),s(t)})})},logout(){a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token"),delete V.a.defaults.headers.common["Authorization"],window.location.reload()}}},D={state:{userCredentials:null,user:null,users:null,friends:null},getters:{usersWithFriendship:e=>{let t=[];return e.users&&e.friends&&e.users.forEach(n=>{n.friendship=!1,e.friends.forEach(e=>{e.id===n.id&&(n.friendship=!0)}),t.push(n)}),t}},mutations:{GET_USER_CREDENTIALS:(e,t)=>{e.userCredentials=t},GET_USER:(e,t)=>{e.user=t},GET_USERS:(e,t)=>{e.users=t},GET_FRIENDS:(e,t)=>{e.friends=t}},actions:{getUsers({commit:e,state:t}){V.a.get("/users").then((function(t){e("GET_USERS",t.data)})).catch(e=>{console.log(e)})},getUser({commit:e,state:t},n){V.a.get("/users/"+n).then((function(t){e("GET_USER",t.data)})).catch(e=>{console.log(e)})},getFriends({commit:e,state:t}){V.a.get("/users/friends").then((function(t){e("GET_FRIENDS",t.data)})).catch(e=>{console.log(e)})},addFriend({commit:e,state:t},n){return new Promise((e,t)=>{V.a.get("/users/friends/"+n+"/add").then((function(t){e(t.data)})).catch(e=>{t(e)})})},deleteFriend({commit:e,state:t},n){return new Promise((e,t)=>{V.a.delete("/users/friends/"+n+"/delete").then((function(t){e(t.data)})).catch(e=>{t(e)})})},getUserCredentials({commit:e,state:t}){V.a.get("/users/info").then((function(t){e("GET_USER_CREDENTIALS",t.data)})).catch(e=>{console.log(e)})}}},K={state:{chat:null,chats:null,ws:null,wsStatus:"none"},getters:{},mutations:{GET_CHAT:(e,t)=>{e.chat=t},GET_CHATS:(e,t)=>{e.chats=t},PUSH_MESSAGE:(e,t)=>{e.chat.messages.push(t)},CONN_WEBSOCKET:(e,t)=>{e.ws=t,e.wsStatus="success",console.log("Connected")},ERROR_WEBSOKET:e=>{e.wsStatus="error"},LOADING_WEBSOKET:e=>{e.wsStatus="loading"},CLOSE_WEBSOCKET:e=>{e.ws&&e.ws.close(),e.wsStatus="none"}},actions:{getChats({commit:e,state:t}){V.a.get("/chats").then((function(t){e("GET_CHATS",t.data)})).catch(e=>{console.log(e)})},getChat({commit:e,dispatch:t},n){t("wsClose"),e("LOADING_WEBSOKET"),V.a.get("/chats/"+n).then((function(n){e("GET_CHAT",n.data),t("wsConn",n.data.identifier)})).catch(t=>{e("ERROR_WEBSOCKET"),console.log(t)})},wsConn({commit:e,state:t},n){const a="https:"===window.location.protocol?"wss":"ws";let s=new WebSocket(a+"://localhost:4545/ws/conn?id="+n);e("CONN_WEBSOCKET",s),t.ws.onclose=function(e){console.log("Connection closed")},t.ws.onmessage=function(t){var n=JSON.parse(t.data);e("PUSH_MESSAGE",n)}},wsClose({commit:e,state:t}){t.chat=null,e("CLOSE_WEBSOCKET")},wsSendMessage({commit:e,state:t},n){return new Promise((a,s)=>{t.ws?(t.ws.send(JSON.stringify(n)),a()):(e("ERROR_WEBSOKET"),s())})}}};a["a"].use(B["a"]),V.a.defaults.baseURL=`${W.host}/api`;var F=new B["a"].Store({state:{},mutations:{},actions:{},modules:{auth:$,user:D,chat:K}});a["a"].use(m["a"]);const z=(e,t,n)=>{F.getters.isAuth?n():n("/sign_in")},J=(e,t,n)=>{F.getters.isAuth?n("/"):n()};var q=new m["a"]({mode:"history",base:"/",routes:[{path:"/",component:G,children:[{path:"",name:"menu",component:()=>Promise.all([n.e("chunk-39ad721c"),n.e("chunk-3850b694")]).then(n.bind(null,"fb62"))},{path:"chats",name:"chats",component:()=>Promise.all([n.e("chunk-39ad721c"),n.e("chunk-566a4814")]).then(n.bind(null,"ac11"))},{path:"friends",name:"friends",component:()=>Promise.all([n.e("chunk-39ad721c"),n.e("chunk-608f7f58")]).then(n.bind(null,"d318"))},{path:"settings",name:"settings",component:()=>Promise.all([n.e("chunk-39ad721c"),n.e("chunk-42370543")]).then(n.bind(null,"f9ea"))},{path:"users",name:"users",component:()=>Promise.all([n.e("chunk-39ad721c"),n.e("chunk-7eba8c30")]).then(n.bind(null,"dbef"))}],beforeEnter:z},{path:"/sign_in",name:"sign_in",component:()=>n.e("chunk-7f6c7d8e").then(n.bind(null,"54e2")),beforeEnter:J},{path:"/sign_up",name:"sign_up",component:()=>n.e("chunk-ee490326").then(n.bind(null,"5c9c")),beforeEnter:J}]}),Q=n("f309");a["a"].use(Q["a"]);var Y=new Q["a"]({}),X=n("00e7"),Z=n.n(X);a["a"].use(Z.a),a["a"].config.productionTip=!1;const ee=a["a"].cookie.get("access_token"),te=a["a"].cookie.get("refresh_token"),ne=a["a"].cookie.get("expires_in");ee&&ne&&te?(F.state.auth.token=ee,F.state.auth.expiresIn=ne,V.a.defaults.headers.common["Authorization"]="Bearer "+ee,F.dispatch("getUserCredentials")):(a["a"].cookie.delete("access_token"),a["a"].cookie.delete("expires_in"),a["a"].cookie.delete("refresh_token")),new a["a"]({router:q,store:F,vuetify:Y,render:e=>e(p)}).$mount("#app")},6908:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app-bar",{attrs:{dense:"",dark:"",flat:""}},[e._t("prepend"),n("v-toolbar-title",[e._t("title",[e._v("\n            Label\n        ")])],2),e._t("append")],2)},s=[],r={name:"Toolbar"},o=r,i=n("2877"),c=n("6544"),l=n.n(c),u=n("40dc"),d=n("2a7f"),h=Object(i["a"])(o,a,s,!1,null,null,null);t["a"]=h.exports;l()(h,{VAppBar:u["a"],VToolbarTitle:d["a"]})},f196:function(e,t,n){"use strict";var a=n("f760"),s=n.n(a);s.a},f760:function(e,t,n){}});
//# sourceMappingURL=app.f2ab3529.js.map